<% content_for :title, "Movies" %>

<style>
  .movies-page { max-width: 960px; margin: 0 auto; padding: 2rem 1rem; font-family: system-ui, sans-serif; }
  .movies-page h1 { margin-bottom: 1.5rem; font-size: 1.75rem; }
  .movies-list { display: grid; gap: 1.5rem; }
  .movie-card { display: flex; gap: 1.25rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; }
  .movie-card img { width: 120px; height: 180px; object-fit: cover; border-radius: 6px; background: #dee2e6; }
  .movie-info { flex: 1; }
  .movie-info h2 { margin: 0 0 0.25rem; font-size: 1.15rem; }
  .movie-meta { color: #6c757d; font-size: 0.875rem; margin-bottom: 0.5rem; }
  .movie-info p { margin: 0; font-size: 0.9rem; line-height: 1.4; color: #495057; }
  .pagination { display: flex; gap: 0.25rem; flex-wrap: wrap; list-style: none; padding: 0; margin: 0; }
  .pagination a, .pagination span { display: inline-block; padding: 0.5rem 0.75rem; border: 1px solid #dee2e6; border-radius: 4px; text-decoration: none; color: #0d6efd; }
  .pagination a:hover { background: #e9ecef; }
  .pagination .current { background: #0d6efd; color: #fff; border-color: #0d6efd; }
  .pagination .disabled span { color: #adb5bd; cursor: not-allowed; }
  .movie-card-actions { flex-shrink: 0; align-self: flex-start; }
  .movie-card-actions form { display: inline-block; margin: 0; }
  .btn-like {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 0.4rem; min-width: 36px; min-height: 36px;
    border: 1px solid #dee2e6; border-radius: 8px;
    background: #fff; color: #495057; cursor: pointer;
    transition: border-color 0.15s ease, background 0.15s ease, color 0.15s ease;
    font-size: 0.875rem;
  }
  .btn-like:hover { border-color: #dc3545; background: #fff5f5; color: #dc3545; }
  .btn-like.liked { border-color: #dc3545; background: #dc3545; color: #fff; }
  .btn-like.liked:hover { background: #c82333; border-color: #c82333; color: #fff; }
</style>

<div class="movies-page">
  <%= render "shared/navbar" %>
  <h1>Movies</h1>
  <p class="movie-meta" style="margin-bottom: 1rem;">Page <%= @movies.current_page %> of <%= @movies.total_pages %> (<%= @movies.total_entries %> movies).</p>

  <div class="movies-list">
    <% @movies.each do |movie| %>
      <div class="movie-card">
        <% if movie.poster_url.present? %>
          <img src="<%= movie.poster_url %>" alt="<%= movie.title %>" onerror="this.src='https://placehold.co/120x180/1a1a1a/fff?text=No+Poster'; this.onerror=null;">
        <% else %>
          <img src="https://placehold.co/120x180/1a1a1a/fff?text=No+Poster" alt="<%= movie.title %>">
        <% end %>
        <div class="movie-info">
          <h2><%= movie.title %></h2>
          <div class="movie-meta">
            <%= movie.year if movie.year %> Â· <%= movie.genres.pluck(:name).join(", ") %>
          </div>
          <% if movie.description.present? %>
            <p><%= truncate(movie.description, length: 200) %></p>
          <% end %>
        </div>
        <div class="movie-card-actions">
          <turbo-frame id="like-button-<%= movie.id %>">
            <%= render "movies/likes/like_button", movie: movie %>
          </turbo-frame>
        </div>
      </div>
    <% end %>
  </div>

  <div class="pagination-wrapper" style="margin-top: 2rem;">
    <%= will_paginate @movies %>
  </div>
</div>
